<!--<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Base64 Encoder with Auto Copy</title>
</head>
<body>
    <h2>画像・絵文字・音声・動画をBase64にエンコード</h2>
    
    <!-- 絵文字用の入力ボックス --
    <label for="emojiInput">絵文字:</label>
    <input type="text" id="emojiInput" placeholder="絵文字を入力">
    <br><br>

    <!-- ファイル入力 --
    <label for="fileInput">ファイル選択:</label>
    <input type="file" id="fileInput" accept="image/*,audio/*,video/*">
    <br><br>

    <!-- プレビュー用 --
    <img id="imagePreview" style="max-width: 300px;">
    <audio id="audioPreview" controls style="display:none;"></audio>
    <video id="videoPreview" controls style="display:none;"></video>
    <br><br>

    <!-- Base64出力用のテキストエリア --
    <textarea id="base64Output" rows="10" cols="100" readonly></textarea>
    <br><br>

    <script>
        // 絵文字を画像に変換してBase64エンコード
        function encodeEmojiToBase64(emoji) {
            const canvas = document.createElement("canvas");
            const context = canvas.getContext("2d");
            context.font = "100px sans-serif";  // フォントサイズの設定
            const textWidth = context.measureText(emoji).width;
            canvas.width = textWidth;
            canvas.height = 120; // 高さの設定

            context.fillText(emoji, 0, 100);
            const base64Data = canvas.toDataURL("image/png");  // Base64エンコード
            return base64Data;
        }

        // 絵文字入力時の処理
        document.getElementById("emojiInput").addEventListener("input", function(event) {
            const emoji = event.target.value;
            if (emoji) {
                const base64Image = encodeEmojiToBase64(emoji);
                document.getElementById("base64Output").value = base64Image;
                document.getElementById("imagePreview").src = base64Image;  // 画像プレビュー

                // Base64を自動でコピー
                copyToClipboard(base64Image);
            }
        });

        // ファイル選択時の処理
        document.getElementById("fileInput").addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();

                // ファイルタイプに応じた処理
                reader.onload = function(e) {
                    const fileType = file.type;

                    if (fileType.startsWith("image/")) {
                        // 画像の処理
                        const base64Image = e.target.result;
                        document.getElementById("base64Output").value = base64Image;
                        document.getElementById("imagePreview").src = base64Image;  // 画像プレビュー

                        // Base64を自動でコピー
                        copyToClipboard(base64Image);
                    } else if (fileType.startsWith("audio/")) {
                        // 音声の処理
                        const base64Audio = e.target.result;
                        document.getElementById("base64Output").value = base64Audio;
                        document.getElementById("audioPreview").src = base64Audio;  // 音声プレビュー
                        document.getElementById("audioPreview").style.display = "inline";  // 音声プレイヤー表示
                        document.getElementById("videoPreview").style.display = "none";  // 動画プレイヤー非表示

                        // Base64を自動でコピー
                        copyToClipboard(base64Audio);
                    } else if (fileType.startsWith("video/")) {
                        // 動画の処理
                        const base64Video = e.target.result;
                        document.getElementById("base64Output").value = base64Video;
                        document.getElementById("videoPreview").src = base64Video;  // 動画プレビュー
                        document.getElementById("videoPreview").style.display = "inline";  // 動画プレイヤー表示
                        document.getElementById("audioPreview").style.display = "none";  // 音声プレイヤー非表示

                        // Base64を自動でコピー
                        copyToClipboard(base64Video);
                    }
                };

                reader.readAsDataURL(file);  // ファイルをBase64形式で読み込む
            }
        });

        // Clipboard APIでBase64データをクリップボードにコピーする関数
        function copyToClipboard(data) {
            navigator.clipboard.writeText(data).then(function() {
                console.log("Base64データがクリップボードにコピーされました！");
            }).catch(function(err) {
                console.error("クリップボードへのコピーに失敗しました:", err);
            });
        }
    </script>
</body>
</html>-->

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Base64 Encoder with Auto Copy</title>
</head>
<body>
    <h2>画像・絵文字・音声・動画をBase64にエンコード</h2>
    
    <!-- 絵文字用の入力ボックス -->
    <label for="emojiInput">絵文字:</label>
    <input type="text" id="emojiInput" placeholder="絵文字を入力">
    <br><br>

    <!-- ファイル入力 -->
    <label for="fileInput">ファイル選択:</label>
    <input type="file" id="fileInput" accept="image/*,audio/*,video/*">
    <br><br>

    <!-- プレビュー用 -->
    <img id="imagePreview" style="max-width: 300px;">
    <audio id="audioPreview" controls style="display:none;"></audio>
    <video id="videoPreview" controls style="display:none;"></video>
    <br><br>

    <!-- Base64出力用のテキストエリア -->
    <textarea id="base64Output" rows="10" cols="100" readonly></textarea>
    <br><br>

    <script>
        // 絵文字を画像に変換してBase64エンコード
        function encodeEmojiToBase64(emoji) {
            const canvas = document.createElement("canvas");
            const context = canvas.getContext("2d");
            context.font = "100px sans-serif";  // フォントサイズの設定
            const textWidth = context.measureText(emoji).width;
            canvas.width = textWidth;
            canvas.height = 120; // 高さの設定

            context.fillText(emoji, 0, 100);
            const base64Data = canvas.toDataURL("image/png");  // Base64エンコード
            return base64Data;
        }

        // 絵文字入力時の処理
        document.getElementById("emojiInput").addEventListener("input", function(event) {
            const emoji = event.target.value;
            if (emoji) {
                const base64Image = encodeEmojiToBase64(emoji);
                document.getElementById("base64Output").value = base64Image;
                document.getElementById("imagePreview").src = base64Image;  // 画像プレビュー

                // Base64を自動でコピー
                copyToClipboard(base64Image);
            }
        });

        // ファイル選択時の処理
        document.getElementById("fileInput").addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (file) {
                // ファイルのサイズが大きい場合の分割読み込み
                if (file.size > 1024 * 1024 * 10) { // 10MB以上
                    handleLargeFile(file);
                } else {
                    handleNormalFile(file);
                }
            }
        });

        // 通常のファイル（小さなファイル）の処理
        function handleNormalFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const base64Data = e.target.result;
                document.getElementById("base64Output").value = base64Data;

                // プレビュー処理
                if (file.type.startsWith("image/")) {
                    document.getElementById("imagePreview").src = base64Data;  // 画像プレビュー
                } else if (file.type.startsWith("audio/")) {
                    document.getElementById("audioPreview").src = base64Data;  // 音声プレビュー
                    document.getElementById("audioPreview").style.display = "inline";  // 音声プレイヤー表示
                    document.getElementById("videoPreview").style.display = "none";  // 動画プレイヤー非表示
                } else if (file.type.startsWith("video/")) {
                    document.getElementById("videoPreview").src = base64Data;  // 動画プレビュー
                    document.getElementById("videoPreview").style.display = "inline";  // 動画プレイヤー表示
                    document.getElementById("audioPreview").style.display = "none";  // 音声プレイヤー非表示
                }

                // Base64を自動でコピー
                copyToClipboard(base64Data);
            };

            reader.readAsDataURL(file);  // ファイルをBase64形式で読み込む
        }

        // 大きなファイル（10MB以上）の処理
        function handleLargeFile(file) {
            // 動画はBase64エンコードせずにURLに変換（Base64でメモリを消費するため）
            if (file.type.startsWith("video/")) {
                const fileURL = URL.createObjectURL(file);
                document.getElementById("base64Output").value = fileURL;
                document.getElementById("videoPreview").src = fileURL; // 動画プレビュー
                document.getElementById("videoPreview").style.display = "inline"; // 動画プレイヤー表示
                document.getElementById("audioPreview").style.display = "none"; // 音声プレイヤー非表示

                // URLを自動でコピー
                copyToClipboard(fileURL);
            } else {
                // それ以外のファイルの場合（画像や音声）は分割読み込み
                const CHUNK_SIZE = 1024 * 1024 * 2; // 2MBごとに分割
                let offset = 0;
                const reader = new FileReader();
                const chunks = [];

                reader.onload = function(e) {
                    chunks.push(e.target.result);
                    offset += CHUNK_SIZE;

                    if (offset < file.size) {
                        readNextChunk();  // 次のチャンクを読み込む
                    } else {
                        const base64Data = chunks.join('');
                        document.getElementById("base64Output").value = base64Data;

                        // プレビュー処理（最初のチャンクの内容をプレビューに反映）
                        if (file.type.startsWith("image/")) {
                            document.getElementById("imagePreview").src = base64Data;  // 画像プレビュー
                        } else if (file.type.startsWith("audio/")) {
                            document.getElementById("audioPreview").src = base64Data;  // 音声プレビュー
                            document.getElementById("audioPreview").style.display = "inline";  // 音声プレイヤー表示
                            document.getElementById("videoPreview").style.display = "none";  // 動画プレイヤー非表示
                        }

                        // Base64を自動でコピー
                        copyToClipboard(base64Data);
                    }
                };

                // 次のチャンクを読み込む
                function readNextChunk() {
                    const slice = file.slice(offset, offset + CHUNK_SIZE);
                    reader.readAsDataURL(slice);
                }

                // 初回チャンクの読み込み
                readNextChunk();
            }
        }

        // Clipboard APIでBase64データをクリップボードにコピーする関数
        function copyToClipboard(data) {
            navigator.clipboard.writeText(data).then(function() {
                console.log("データがクリップボードにコピーされました！");
            }).catch(function(err) {
                console.error("クリップボードへのコピーに失敗しました:", err);
            });
        }
    </script>
</body>
</html>
